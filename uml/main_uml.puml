@startuml

skinparam class {
BackgroundColor<<Main>> Snow
BorderColor<<Main>> Orange
}
skinparam stereotypeCBackgroundColor<< Main >> Khaki

class ApplicationClient<<Main>>
{
    -{static}con
    -{static}app
    -{static}Main()
    -{static}ShowSimulationMenu()
    -{static}DriveIn()
    -{static}DriveOut()
    -{static}Register()
    '-{static}IncorrectCommand()
}

class Application<<Singleton>>
{
    -{static}instance: Application
    +entranceDevices: List<EntranceParkingMachine>
    +exitDevices: List<ExitParkingMachine>
    +registerDevices: List<RegisterSystem>
    +{static}GetInstance(): Application
    -Init(): void
    +GetEntranceDevices(): List
    +GetExitDevices(): List
    +GetRegisterDevices(): List
}

ApplicationClient --> Application: init




package "DeviceInterface"{
    interface IGateAPI{
        +OpenGate()
    }

    interface IPrinterAPI{
        +PrintTicket(Ticket t)
    }

    interface ISimpleDialog{
        +ShowMessage(String msg): void
        +ReadString(): string
    }

    class ConsoleDisplay<<Singleton>> implements ISimpleDialog{
        -{static}instance: ConsoleDisplay
        +{static}GetInstance(): ConsoleDisplay
        +ShowMessage(String msg): void
        +ReadString(): string
    }

    class ConsoleMachineAPI implements  ISimpleDialog, IGateAPI, IStandardButtonsAPI, ICashMachineAPI, IPrinterAPI{

    }

    Note bottom of ConsoleMachineAPI: This would be API of real\nparking machine, but instead\nit uses console via\n<b>adapter pattern

    interface IStandardButtonsAPI {
        +AddButtonObserver(ButtonKey key, IButtonObserver o): void
        +RemoveButtonObserver(ButtonKey key, IButtonObserver o): void
        +AnnounceButtonPressedAll(ButtonKey key): void
        +AnnounceButtonPressed(ButtonKey key,IButtonObserver o): void
    }
    IStandardButtonsAPI -d- ButtonKey
    IStandardButtonsAPI o--"list for each\nbutton type" IButtonObserver

    enum ButtonKey{
        ACCEPT_BUTTON
        SPECIAL_BUTTON
        CANCEL_BUTTON
    }


    interface IButtonObserver
    {
        -ButtonPressed(ButtonKey key): void
    }
    note bottom: <b>observer\n<b>pattern


    ConsoleMachineAPI o-> ConsoleDisplay
    ApplicationClient --> ISimpleDialog: use console
    ApplicationClient --> IStandardButtonsAPI:simulate pressing

    package "PaymentSystem"{
       interface ICashMachineAPI
       {
           +InsertCoin(AllowedDenominations denomination): void
           +PayByDebitCard(string debitCardData, int valuePLN, int valueGR): bool
       }

       class Denomination
       {
           -valueInGR: int
           +amount: int
       }

       interface CashChangeStrategy
       {

       }

       ICashMachineAPI o--> CashChangeStrategy
       ICashMachineAPI *-- Denomination
       Denomination . CashChangeStrategy
    }
}


package "Devices"<<logic of various devices>>{

    class Device <<Abstract>> implements IButtonObserver{
        -IGateAPI: display
        '+{abstract}AcceptButtonPressed(): void
        +{abstract}Main(): void
    }

    class RegisterSystem extends Device
    {
        +CancelButtonPressed(): void
        +KeyboardInput(): string
    }

    class GateDevice<<Abstract>> extends Device{
        +CheckCard()
        #CloseIfClear()
    }

    class PaymentDevice extends Device{
        #DisposeChange(Denomination coins): void
    }

    class ExitParkingMachine extends GateDevice
    {

    }

    class EntranceParkingMachine extends GateDevice
    {

    }
}
"Devices"->"DeviceInterface": devices are\nusing various\ninterfaces


package ParkingSystem{

    class TicketDatabase{
        -counter: int
        -maxPlaces: int
        +TryAddTicket(): void
        +EvaluateTicket(string code):
    }

    class Ticket<<immutable>>{
        -code: string
        -entranceTime: DateTime
        +Code.get(): string
        +EntanceTime.get(): DateTime
    }
    note bottom: <b>flyweight pattern

    interface ITicketCodeGenerator
    {
        +Generate()
    }
    note right: <b>strategy\n<b>pattern

    class GUIDGenerator implements ITicketCodeGenerator

    TicketDatabase *-- Ticket
    TicketDatabase -> ITicketCodeGenerator

    ' ? class PremiumPlaces implements IPlaceCounter
}

package PremiumUser{

    interface IDriverDatabase
    {
        +Register(String driversPlate): void
    }
    class PremiumProxy implements IDriverDatabase{

    }
    class PremiumDatabase implements IDriverDatabase{
    }


    PremiumProxy --> PremiumDatabase :uses
}







Devices o--> TicketDatabase: uses
RegisterSystem --> PremiumProxy: uses
GateDevice --> PremiumDatabase: \n\n\n\n\n\n\nuses
'some smelly tricks right here

Application o-->"n" Device

@enduml